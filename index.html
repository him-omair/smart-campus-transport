<!DOCTYPE html>
<html lang="ar" class="h-full" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    * {
      direction: rtl;
    }
    
    body {
      box-sizing: border-box;
      font-family: 'Almarai', sans-serif;
    }
    
    html, body {
      height: 100%;
    }
    
    ::-webkit-scrollbar {
      width: 4px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: #10b981;
      border-radius: 4px;
    }
    
    .leaflet-container {
      background: #1a3a1a;
    }
    
    .gradient-dark {
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
    }
    
    .gradient-card {
      background: linear-gradient(145deg, rgba(30,41,59,0.9) 0%, rgba(15,23,42,0.95) 100%);
      backdrop-filter: blur(10px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
    }
    
    .btn-amber {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      transition: all 0.3s ease;
    }
    
    .btn-amber:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .floating {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .status-live {
      animation: blink 1.5s ease-in-out infinite;
    }
    
    .view-hidden {
      display: none !important;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .slide-up {
      animation: slideUp 0.4s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    
    .bottom-panel {
      height: 40%;
      overflow-y: auto;
    }
    
    .zone-button {
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #334155;
      background: rgba(30, 41, 59, 0.5);
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: right;
    }
    
    .zone-button:hover {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }
    
    .zone-button.active {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.3);
      color: #10b981;
    }
    
    .input-field {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      color: white;
      font-family: 'Almarai', sans-serif;
      width: 100%;
    }
    
    .input-field:focus {
      outline: none;
      border-color: #10b981;
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.2);
    }
    
    .input-field::placeholder {
      color: #64748b;
    }
    
    .zone-marker {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #10b981, #059669);
      border-radius: 50%;
      border: 3px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      cursor: pointer;
    }

    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    .pulse-marker {
      animation: pulse-ring 2s ease-out infinite;
    }

    .ai-hint {
      background: linear-gradient(145deg, rgba(139,92,246,0.15) 0%, rgba(59,130,246,0.1) 100%);
      border: 1px solid rgba(139,92,246,0.3);
    }
  </style>
</head>
<body class="h-full gradient-dark text-white overflow-auto">
  
  <!-- ==================== LOGIN VIEW ==================== -->
  <div id="login-view" class="h-full flex flex-col">
    <div class="relative flex-1 flex flex-col items-center justify-center p-6">
      <!-- Logo -->
      <div class="mb-8 floating">
        <div class="w-24 h-24 mx-auto rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center" style="box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);">
          <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
          </svg>
        </div>
      </div>
      
      <!-- Title -->
      <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-emerald-400 to-teal-300 bg-clip-text text-transparent">
        Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ
      </h1>
      <p class="text-slate-400 text-lg mb-8">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…ÙˆØµÙ„</p>
      
      <!-- User Type Selection -->
      <div id="login-user-type-selection" class="w-full max-w-md space-y-3 mb-6">
        <p class="text-slate-400 text-sm mb-3">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</p>
        <button onclick="selectLoginUserType('student')" class="w-full py-3 rounded-xl btn-primary text-white font-bold flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Ø·Ø§Ù„Ø¨
        </button>
        <button onclick="selectLoginUserType('car-driver')" class="w-full py-3 rounded-xl btn-secondary text-white font-bold flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
          </svg>
          Ø³Ø§Ø¦Ù‚ Ø³ÙŠØ§Ø±Ø©
        </button>
        <button onclick="selectLoginUserType('bus-driver')" class="w-full py-3 rounded-xl btn-amber text-white font-bold flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h8m-8 4h8m-6 4h4M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"></path>
          </svg>
          Ø³Ø§Ø¦Ù‚ Ø­Ø§ÙÙ„Ø©
        </button>
        <button onclick="selectLoginUserType('admin')" class="w-full py-3 rounded-xl bg-slate-700 text-white font-bold flex items-center justify-center gap-3">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          </svg>
          Ø¥Ø¯Ø§Ø±Ø©
        </button>
      </div>

      <!-- Login Form -->
      <div id="login-form" class="w-full max-w-md space-y-4 view-hidden">
        <div>
          <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input id="login-email" type="email" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ø¨Ø±ÙŠØ¯ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±">
        </div>

        <button onclick="handleLogin()" class="w-full py-3 rounded-xl btn-primary text-white font-bold text-lg">
          Ø¯Ø®ÙˆÙ„
        </button>

        <button onclick="resetLoginView()" class="w-full py-2 rounded-xl bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">
          Ø±Ø¬ÙˆØ¹
        </button>

        <div class="relative my-4">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-slate-700"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-slate-900 text-slate-400">Ø£Ù… Ø£Ù†Øª Ø¬Ø¯ÙŠØ¯ØŸ</span>
          </div>
        </div>

        <button onclick="showView('register')" class="w-full py-3 rounded-xl bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium">
          Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        </button>
      </div>
      
      <!-- University Logo -->
      <div class="mt-12 text-center">
        <div class="w-16 h-16 mx-auto mb-3 bg-slate-800/50 rounded-full flex items-center justify-center">
          <span class="text-3xl">ğŸ“</span>
        </div>
        <p class="text-slate-500 text-xs">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…ÙˆØµÙ„</p>
      </div>
    </div>
  </div>
  
  <!-- ==================== REGISTER VIEW ==================== -->
  <div id="register-view" class="h-full flex flex-col view-hidden">
    <div class="flex-1 flex flex-col p-6 overflow-auto">
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <button onclick="showView('login')" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        <h1 class="text-lg font-bold">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h1>
        <div class="w-10 h-10"></div>
      </div>
      
      <!-- User Type Selection -->
      <div class="mb-6">
        <p class="text-slate-400 text-sm mb-3">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</p>
        <div class="space-y-3">
          <button onclick="selectUserType('student')" id="btn-student-type" class="w-full py-3 rounded-xl btn-primary text-white font-bold flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            Ø·Ø§Ù„Ø¨
          </button>
          <button onclick="selectUserType('car-driver')" id="btn-car-driver-type" class="w-full py-3 rounded-xl bg-slate-800/50 border border-slate-700/50 text-slate-400 font-bold flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            </svg>
            Ø³Ø§Ø¦Ù‚ Ø³ÙŠØ§Ø±Ø©
          </button>
          <button onclick="selectUserType('bus-driver')" id="btn-bus-driver-type" class="w-full py-3 rounded-xl bg-slate-800/50 border border-slate-700/50 text-slate-400 font-bold flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h8m-8 4h8m-6 4h4M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"></path>
            </svg>
            Ø³Ø§Ø¦Ù‚ Ø­Ø§ÙÙ„Ø©
          </button>
          <button onclick="selectUserType('admin')" id="btn-admin-type" class="w-full py-3 rounded-xl bg-slate-800/50 border border-slate-700/50 text-slate-400 font-bold flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            </svg>
            Ø¥Ø¯Ø§Ø±Ø©
          </button>
        </div>
      </div>
      
      <!-- Registration Form -->
      <div id="registration-form" class="view-hidden space-y-4">
        <!-- Common Fields -->
        <div id="common-fields">
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input id="reg-name" type="text" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <input id="reg-email" type="email" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input id="reg-phone" type="tel" class="input-field" placeholder="07701234567">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input id="reg-password" type="password" class="input-field" placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ©">
          </div>
        </div>
        
        <!-- Student Fields -->
        <div id="student-fields" class="view-hidden">
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø¬Ù†Ø³</label>
            <select id="reg-gender" class="input-field">
              <option value="">Ø§Ø®ØªØ±</option>
              <option value="male">Ø°ÙƒØ±</option>
              <option value="female">Ø£Ù†Ø«Ù‰</option>
            </select>
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø¹Ù…Ø±</label>
            <input id="reg-age" type="number" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø±Ùƒ">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="reg-disability" type="text" class="input-field" placeholder="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ø§Ù‚Ø©">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <textarea id="reg-notes" class="input-field resize-none" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"></textarea>
          </div>
        </div>
        
        <!-- Car Driver Fields -->
        <div id="car-driver-fields" class="view-hidden">
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
            <input id="reg-car-model" type="text" class="input-field" placeholder="Ù…Ø«Ø§Ù„: Toyota 2020">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
            <input id="reg-car-plate" type="text" class="input-field" placeholder="Ù…Ø«Ø§Ù„: 1234 MOS">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø±Ù‚Ù… Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</label>
            <input id="reg-driver-license" type="text" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©">
          </div>
        </div>
        
        <!-- Bus Driver Fields -->
        <div id="bus-driver-fields" class="view-hidden">
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø§ÙÙ„Ø©</label>
            <input id="reg-bus-model" type="text" class="input-field" placeholder="Ù…Ø«Ø§Ù„: Mercedes 2019">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ø­Ø§ÙÙ„Ø©</label>
            <input id="reg-bus-plate" type="text" class="input-field" placeholder="Ù…Ø«Ø§Ù„: 5678 BUS">
          </div>
          
          <div>
            <label class="block text-slate-400 text-sm mb-2">Ø±Ù‚Ù… Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</label>
            <input id="reg-bus-license" type="text" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©">
          </div>
        </div>
        
        <!-- Submit Button -->
        <button onclick="handleRegister()" class="w-full py-3 rounded-xl btn-primary text-white font-bold">
          Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
        </button>
      </div>
    </div>
  </div>
  
  <!-- ==================== STUDENT DASHBOARD ==================== -->
  <div id="student-dashboard-view" class="h-full flex flex-col view-hidden">
    <!-- Top Navigation -->
    <div class="flex items-center justify-between p-4 bg-slate-900/50 border-b border-slate-800">
      <button onclick="handleLogout()" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </button>
      
      <h1 class="text-lg font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
      
      <div class="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center">
        <span class="text-lg">ğŸ‘¤</span>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="flex gap-2 p-4 bg-slate-900/30 border-b border-slate-800">
      <button onclick="switchStudentTab('zones')" id="student-tab-zones" class="flex-1 py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-medium text-sm">Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</button>
      <button onclick="switchStudentTab('request')" id="student-tab-request" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„</button>
      <button onclick="switchStudentTab('history')" id="student-tab-history" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø§Ù„Ø³Ø¬Ù„</button>
    </div>
    
    <!-- Content -->
    <div class="flex-1 overflow-auto p-4">
      <!-- Zones Tab -->
      <div id="student-zones-tab">
        <p class="text-slate-400 text-sm mb-4">Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ø£Ùˆ Ø­Ø¯Ø¯ ÙˆØ¬Ù‡ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡Ø§</p>

        <div class="space-y-2 mb-6">
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø©', 1)" class="zone-button w-full">ğŸ­ Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø©</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø©', 2)" class="zone-button w-full">ğŸ¢ Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø©</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ø¹Ø¨', 3)" class="zone-button w-full">âš½ Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ø¹Ø¨</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ…', 4)" class="zone-button w-full">ğŸ”¬ Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ…</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©', 5)" class="zone-button w-full">ğŸ¥ Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†', 6)" class="zone-button w-full">ğŸ¦· Ø¨Ø§Ø¨ Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†</button>
          <button onclick="selectZone('Ø¨Ø§Ø¨ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©', 7)" class="zone-button w-full">ğŸŒ¾ Ø¨Ø§Ø¨ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©</button>
          <button onclick="selectZone('Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©', 8)" class="zone-button w-full">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</button>
          <button onclick="selectZone('Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ', 9)" class="zone-button w-full">ğŸ“ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</button>
        </div>
        
        <!-- Selected Zone Info -->
        <div id="selected-zone-info" class="view-hidden gradient-card rounded-lg p-4 border border-slate-700/50 mb-4">
          <p class="text-slate-400 text-xs mb-2">Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</p>
          <p id="selected-zone-name" class="text-white font-bold text-lg mb-3">--</p>
          <p class="text-slate-400 text-xs mb-2">Ù…Ù‚ÙŠÙ‘Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
          <div class="flex items-center gap-2 mb-3">
            <span class="text-yellow-400">â­</span>
            <p id="zone-ai-rating" class="text-white">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© - ØªÙˆÙØ± Ù†Ù‚Ù„</p>
          </div>
          <button onclick="switchStudentTab('request')" class="w-full py-2 rounded-lg btn-primary text-white font-bold text-sm">Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>
      
      <!-- Request Tab -->
      <div id="student-request-tab" class="view-hidden">
        <div class="mb-4 p-3 rounded-lg bg-blue-500/10 border border-blue-500/30">
          <p class="text-blue-300 text-xs">ğŸ’¡ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ ÙˆØ¬Ù‡ØªÙƒ - Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª ÙˆØ§Ù„Ø³ÙŠØ§Ø±Ø§Øª ØªØªØ­Ø±Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©</p>
        </div>

        <div id="student-map" class="h-96 rounded-lg mb-4 border border-slate-700/50"></div>

        <!-- Live Transport Stats -->
        <div class="gradient-card rounded-lg p-4 border border-slate-700/50 mb-4">
          <div class="flex items-center gap-2 mb-3">
            <span class="w-2 h-2 rounded-full bg-emerald-400 status-live"></span>
            <p class="text-slate-400 text-xs font-bold">ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</p>
          </div>
          <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="text-center py-2 rounded-lg bg-slate-800/50">
              <p id="live-bus-count" class="text-lg font-bold text-emerald-400">3</p>
              <p class="text-xs text-slate-400">ğŸšŒ Ø­Ø§ÙÙ„Ø§Øª</p>
            </div>
            <div class="text-center py-2 rounded-lg bg-slate-800/50">
              <p id="live-car-count" class="text-lg font-bold text-amber-400">4</p>
              <p class="text-xs text-slate-400">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</p>
            </div>
            <div class="text-center py-2 rounded-lg bg-slate-800/50">
              <p id="live-eta" class="text-lg font-bold text-blue-400">3Ø¯</p>
              <p class="text-xs text-slate-400">Ø£Ù‚Ø±Ø¨ ÙˆØµÙˆÙ„</p>
            </div>
          </div>

          <p class="text-slate-400 text-xs mb-2">Ø§Ù„ÙˆØ¬Ù‡Ø©</p>
          <p id="request-destination" class="text-white font-bold mb-4">Ø§Ø®ØªØ± ÙˆØ¬Ù‡Ø©</p>

          <button id="request-button" onclick="requestRide()" class="w-full py-3 rounded-lg btn-primary text-white font-bold">
            Ø·Ù„Ø¨ ØªÙˆØµÙŠÙ„
          </button>
        </div>

        <!-- AI Insights -->
        <div class="mb-4">
          <p class="text-slate-400 text-xs font-bold mb-2">ğŸ¤– ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
          <div id="student-ai-hints" class="space-y-2">
            <!-- AI hints will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- History Tab -->
      <div id="student-history-tab" class="view-hidden">
        <p class="text-slate-400 text-sm">Ù„Ù… ØªÙ‚Ù… Ø¨Ø±Ø­Ù„Ø§Øª Ø¨Ø¹Ø¯</p>
      </div>
    </div>
  </div>
  
  <!-- ==================== DRIVER DASHBOARD ==================== -->
  <div id="driver-dashboard-view" class="h-full flex flex-col view-hidden">
    <div class="flex items-center justify-between p-4 bg-slate-900/50 border-b border-slate-800">
      <button onclick="handleLogout()" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </button>
      
      <h1 id="driver-title" class="text-lg font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚</h1>
      
      <div id="driver-points-badge" class="px-3 py-1 rounded-full bg-amber-500/20 border border-amber-500 text-amber-400 text-sm font-bold">
        0 Ù†Ù‚Ø·Ø©
      </div>
    </div>
    
    <div class="flex gap-2 p-4 bg-slate-900/30 border-b border-slate-800">
      <button onclick="switchDriverTab('map')" id="driver-tab-map" class="flex-1 py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-medium text-sm">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
      <button onclick="switchDriverTab('requests')" id="driver-tab-requests" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
      <button onclick="switchDriverTab('profile')" id="driver-tab-profile" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø§Ù„Ù…Ù„Ù</button>
    </div>
    
    <div class="flex-1 overflow-auto">
      <!-- Map Tab -->
      <div id="driver-map-tab" class="h-full flex flex-col">
        <div id="driver-map" class="flex-1" style="min-height: 350px;"></div>
        <!-- Driver AI Alert Banner -->
        <div id="driver-ai-alert" class="p-3 bg-gradient-to-r from-red-500/10 to-orange-500/10 border-t border-red-500/30">
          <p class="text-white font-bold text-xs">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø°ÙƒÙŠ: Ø·Ù„Ø¨ Ø¹Ø§Ù„ÙŠ!</p>
          <p id="driver-alert-text" class="text-slate-300 text-xs">~8 Ø·Ù„Ø§Ø¨ Ù…ØªÙˆÙ‚Ø¹ÙŠÙ† ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ Ø®Ù„Ø§Ù„ 10 Ø¯Ù‚Ø§Ø¦Ù‚</p>
        </div>
        <!-- Driver Stats -->
        <div class="p-3 bg-slate-900/50 border-t border-slate-800">
          <div class="grid grid-cols-3 gap-2">
            <div class="text-center">
              <p id="driver-nearby-students" class="text-xl font-bold text-blue-400">0</p>
              <p class="text-slate-500 text-xs">Ø·Ù„Ø§Ø¨ Ù‚Ø±ÙŠØ¨ÙˆÙ†</p>
            </div>
            <div class="text-center">
              <p id="driver-active-requests" class="text-xl font-bold text-amber-400">0</p>
              <p class="text-slate-500 text-xs">Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</p>
            </div>
            <div class="text-center">
              <p id="driver-suggested-route" class="text-xl font-bold text-emerald-400">--</p>
              <p class="text-slate-500 text-xs">Ø§Ù„Ù…Ø³Ø§Ø±</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Requests Tab -->
      <div id="driver-requests-tab" class="view-hidden p-4">
        <!-- AI Insights for driver -->
        <div class="mb-4">
          <p class="text-slate-400 text-xs font-bold mb-2">ğŸ¤– ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
          <div id="driver-ai-hints" class="space-y-2">
            <!-- AI hints will be populated here -->
          </div>
        </div>
        <p class="text-slate-400 text-xs font-bold mb-2">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</p>
        <div id="driver-requests-list" class="space-y-3">
          <!-- Requests will be populated here -->
        </div>
      </div>
      
      <!-- Profile Tab -->
      <div id="driver-profile-tab" class="view-hidden p-4">
        <div class="gradient-card rounded-lg p-4 border border-slate-700/50 space-y-3">
          <div>
            <p class="text-slate-400 text-xs">Ø§Ù„Ø§Ø³Ù…</p>
            <p id="driver-profile-name" class="text-white font-bold">--</p>
          </div>
          <div>
            <p class="text-slate-400 text-xs">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</p>
            <p id="driver-profile-email" class="text-white">--</p>
          </div>
          <div>
            <p class="text-slate-400 text-xs">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</p>
            <p id="driver-profile-phone" class="text-white">--</p>
          </div>
          <div id="driver-car-info">
            <p class="text-slate-400 text-xs">Ø§Ù„Ø³ÙŠØ§Ø±Ø©</p>
            <p id="driver-profile-car" class="text-white">--</p>
          </div>
          <div>
            <p class="text-slate-400 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</p>
            <p id="driver-profile-points" class="text-amber-400 font-bold text-lg">0</p>
          </div>
          <div>
            <p class="text-slate-400 text-xs">Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª</p>
            <p id="driver-profile-rides" class="text-white">0</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ==================== ADMIN DASHBOARD ==================== -->
  <div id="admin-dashboard-view" class="h-full flex flex-col view-hidden">
    <div class="flex items-center justify-between p-4 bg-slate-900/50 border-b border-slate-800">
      <button onclick="handleLogout()" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </button>
      
      <h1 class="text-lg font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
      
      <div class="w-10 h-10"></div>
    </div>
    
    <div class="flex gap-2 p-4 bg-slate-900/30 border-b border-slate-800">
      <button onclick="switchAdminTab('drivers')" id="admin-tab-drivers" class="flex-1 py-2 rounded-lg bg-emerald-500/20 border border-emerald-500 text-emerald-400 font-medium text-sm">Ø§Ù„Ø³Ø§Ø¦Ù‚ÙˆÙ†</button>
      <button onclick="switchAdminTab('rewards')" id="admin-tab-rewards" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</button>
      <button onclick="switchAdminTab('schedule')" id="admin-tab-schedule" class="flex-1 py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 font-medium text-sm">Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
    </div>
    
    <div class="flex-1 overflow-auto p-4">
      <!-- Drivers Tab -->
      <div id="admin-drivers-tab">
        <!-- Summary Stats -->
        <div class="grid grid-cols-3 gap-2 mb-4">
          <div class="gradient-card rounded-lg p-3 border border-slate-700/50 text-center">
            <p id="admin-total-drivers" class="text-xl font-bold text-emerald-400">0</p>
            <p class="text-slate-500 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</p>
          </div>
          <div class="gradient-card rounded-lg p-3 border border-slate-700/50 text-center">
            <p id="admin-active-drivers" class="text-xl font-bold text-blue-400">0</p>
            <p class="text-slate-500 text-xs">Ù†Ø´Ø·</p>
          </div>
          <div class="gradient-card rounded-lg p-3 border border-slate-700/50 text-center">
            <p id="admin-total-rides" class="text-xl font-bold text-amber-400">0</p>
            <p class="text-slate-500 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª</p>
          </div>
        </div>
        <p class="text-slate-400 text-xs font-bold mb-2">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</p>
        <div id="admin-drivers-list" class="space-y-3">
          <!-- Drivers will be listed here -->
        </div>
      </div>

      <!-- Rewards Tab -->
      <div id="admin-rewards-tab" class="view-hidden">
        <div class="ai-hint rounded-lg p-3 mb-4">
          <div class="flex items-start gap-2">
            <span class="text-lg">ğŸ†</span>
            <div>
              <p class="text-purple-300 text-xs font-bold">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</p>
              <p class="text-slate-300 text-xs mt-1">Ø§Ø®ØªØ± Ù…ÙƒØ§ÙØ£Ø© Ù„Ù…Ù†Ø­Ù‡Ø§ Ù„Ù„Ø³Ø§Ø¦Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¦Ù‡ ÙˆÙ†Ù‚Ø§Ø·Ù‡</p>
            </div>
          </div>
        </div>
        <div id="admin-rewards-list" class="space-y-3">
          <!-- Reward options -->
        </div>
      </div>

      <!-- Schedule Tab -->
      <div id="admin-schedule-tab" class="view-hidden">
        <div class="ai-hint rounded-lg p-3 mb-4">
          <div class="flex items-start gap-2">
            <span class="text-lg">âš ï¸</span>
            <div>
              <p class="text-purple-300 text-xs font-bold">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø°Ø±ÙˆØ©</p>
              <p class="text-slate-300 text-xs mt-1">Ø­Ø¯Ø¯ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¶ØºØ· ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØºØ·ÙŠØ©</p>
            </div>
          </div>
        </div>

        <!-- Add Peak Entry Form -->
        <div class="gradient-card rounded-lg p-4 border border-slate-700/50 mb-4">
          <p class="text-white font-bold text-sm mb-3">Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø°Ø±ÙˆØ© Ø¬Ø¯ÙŠØ¯</p>
          <div class="space-y-3">
            <div>
              <label class="block text-slate-400 text-xs mb-1">Ø§Ù„ÙŠÙˆÙ…</label>
              <select id="peak-day" class="input-field text-sm">
                <option value="Ø§Ù„Ø£Ø­Ø¯">Ø§Ù„Ø£Ø­Ø¯</option>
                <option value="Ø§Ù„Ø§Ø«Ù†ÙŠÙ†">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                <option value="Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                <option value="Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                <option value="Ø§Ù„Ø®Ù…ÙŠØ³">Ø§Ù„Ø®Ù…ÙŠØ³</option>
              </select>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-slate-400 text-xs mb-1">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                <input id="peak-start-time" type="time" class="input-field text-sm" value="08:00">
              </div>
              <div>
                <label class="block text-slate-400 text-xs mb-1">ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</label>
                <input id="peak-end-time" type="time" class="input-field text-sm" value="09:30">
              </div>
            </div>
            <div>
              <label class="block text-slate-400 text-xs mb-1">Ù…Ù„Ø§Ø­Ø¸Ø© / Ø§Ù„Ø³Ø¨Ø¨</label>
              <input id="peak-note" type="text" class="input-field text-sm" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù…ØªØ­Ø§Ù† ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨">
            </div>
            <button onclick="addPeakEntry()" class="w-full py-3 rounded-lg btn-primary text-white font-bold text-sm">
              Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ø°Ø±ÙˆØ©
            </button>
          </div>
        </div>

        <!-- Peak Schedule List -->
        <p class="text-slate-400 text-xs font-bold mb-2">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
        <div id="peak-schedule-list" class="space-y-3">
          <!-- Peak entries will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== CONFIGURATION ====================
    const defaultConfig = {
      app_title: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ',
      subtitle: 'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…ÙˆØµÙ„'
    };
    
    let config = { ...defaultConfig };
    const MOSUL_CENTER = [36.3417, 43.1195];
    
    // Current user state
    let currentUser = null;
    let allUsers = [];
    let selectedLoginUserType = null;

    // Zone data
    const zones = [
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø©', id: 1, coords: [36.3420, 43.1180], emoji: 'ğŸ­' },
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø©', id: 2, coords: [36.3410, 43.1200], emoji: 'ğŸ¢' },
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„Ù…Ù„Ø¹Ø¨', id: 3, coords: [36.3430, 43.1185], emoji: 'âš½' },
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ…', id: 4, coords: [36.3400, 43.1170], emoji: 'ğŸ”¬' },
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ©', id: 5, coords: [36.3390, 43.1195], emoji: 'ğŸ¥' },
      { name: 'Ø¨Ø§Ø¨ Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù†', id: 6, coords: [36.3405, 43.1160], emoji: 'ğŸ¦·' },
      { name: 'Ø¨Ø§Ø¨ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©', id: 7, coords: [36.3450, 43.1200], emoji: 'ğŸŒ¾' },
      { name: 'Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©', id: 8, coords: [36.3415, 43.1145], emoji: 'ğŸ“š' },
      { name: 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ', id: 9, coords: [36.3425, 43.1210], emoji: 'ğŸ“' }
    ];
    
    // Selected zone
    let selectedZone = null;
    let selectedCustomLocation = null;
    let customLocationMarker = null;
    let studentMap = null;
    let driverMap = null;

    // Simulation state
    let simulationIntervals = [];
    let simBusMarkers = [];
    let simCarMarkers = [];
    let simStudentMarkers = [];
    let busRouteLines = [];

    // Bus route data (predefined routes through campus)
    const busRoutes = [
      {
        id: 1, name: 'Ø®Ø· Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø© - Ø¨Ø§Ø¨ Ø§Ù„Ø²Ø±Ø§Ø¹Ø©',
        points: [
          [36.3420, 43.1180], [36.3425, 43.1185], [36.3430, 43.1190],
          [36.3435, 43.1195], [36.3440, 43.1198], [36.3445, 43.1200], [36.3450, 43.1200]
        ],
        color: '#10b981'
      },
      {
        id: 2, name: 'Ø®Ø· Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ… - Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ',
        points: [
          [36.3400, 43.1170], [36.3405, 43.1175], [36.3410, 43.1185],
          [36.3415, 43.1195], [36.3420, 43.1205], [36.3425, 43.1210]
        ],
        color: '#3b82f6'
      },
      {
        id: 3, name: 'Ø®Ø· Ø¨Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠØ© - Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©',
        points: [
          [36.3390, 43.1195], [36.3395, 43.1185], [36.3400, 43.1175],
          [36.3405, 43.1165], [36.3410, 43.1155], [36.3415, 43.1145]
        ],
        color: '#f59e0b'
      }
    ];

    // AI hints data
    const aiHintsStudent = [
      { icon: 'ğŸ”®', title: 'ØªÙˆÙ‚Ø¹ Ø°ÙƒÙŠ', text: 'Ø§Ø²Ø¯Ø­Ø§Ù… Ù…ØªÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø© Ø®Ù„Ø§Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø© - ÙŠÙÙ†ØµØ­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ…' },
      { icon: 'âš¡', title: 'Ø£Ø³Ø±Ø¹ Ù…Ø³Ø§Ø±', text: 'Ø§Ù„Ø­Ø§ÙÙ„Ø© Ø®Ø· 2 Ù‡ÙŠ Ø§Ù„Ø£Ù‚Ø±Ø¨ Ø¥Ù„ÙŠÙƒ Ø­Ø§Ù„ÙŠØ§Ù‹ - ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: 3 Ø¯Ù‚Ø§Ø¦Ù‚' },
      { icon: 'ğŸ“Š', title: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨', text: 'Ø§Ù„Ø·Ù„Ø¨ Ù…Ù†Ø®ÙØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ - ÙØ±ØµØ© Ø¬ÙŠØ¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹' },
      { icon: 'ğŸŒ¡ï¸', title: 'ØªÙˆÙ‚Ø¹ Ø§Ù„Ø°Ø±ÙˆØ©', text: 'Ø³Ø§Ø¹Ø© Ø§Ù„Ø°Ø±ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: 12:30 - ÙŠÙÙ†ØµØ­ Ø¨Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‚Ø¨Ù„Ù‡Ø§ Ø¨Ù€10 Ø¯Ù‚Ø§Ø¦Ù‚' },
      { icon: 'ğŸ¯', title: 'Ø§Ù‚ØªØ±Ø§Ø­ Ø°ÙƒÙŠ', text: 'Ø±Ø­Ù„Ø© Ù…Ø´ØªØ±ÙƒØ© Ù…ØªØ§Ø­Ø© Ù…Ø¹ 2 Ø·Ù„Ø§Ø¨ Ø¢Ø®Ø±ÙŠÙ† Ù„Ù†ÙØ³ Ø§Ù„ÙˆØ¬Ù‡Ø© - Ø³Ø±Ø¹Ø© Ø£Ø¹Ù„Ù‰' }
    ];

    const aiHintsDriver = [
      { icon: 'ğŸ”¥', title: 'Ù…Ù†Ø·Ù‚Ø© Ø·Ù„Ø¨ Ø¹Ø§Ù„ÙŠ', text: 'Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø© - ~12 Ø·Ø§Ù„Ø¨ ÙŠÙ†ØªØ¸Ø±ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹' },
      { icon: 'ğŸ“ˆ', title: 'ØªÙˆÙ‚Ø¹ Ø§Ù„Ø·Ù„Ø¨', text: 'Ù…ØªÙˆÙ‚Ø¹ Ø²ÙŠØ§Ø¯Ø© 40% ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù†Ø¯ Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ… Ø®Ù„Ø§Ù„ 20 Ø¯Ù‚ÙŠÙ‚Ø©' },
      { icon: 'ğŸ›£ï¸', title: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ù…Ø«Ù„', text: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­: Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø© â† Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø© â† Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©' },
      { icon: 'â°', title: 'ØªÙ†Ø¨ÙŠÙ‡ Ø°Ø±ÙˆØ©', text: 'Ø³Ø§Ø¹Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª 12:30 - ØªÙˆØ¬Ù‡ Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø¹Ù„ÙˆÙ… Ù„Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ø·Ù„Ø§Ø¨' },
      { icon: 'ğŸ’¡', title: 'Ù†ØµÙŠØ­Ø© Ø°ÙƒÙŠØ©', text: 'Ù…Ù†Ø·Ù‚Ø© Ø¨Ø§Ø¨ Ø·Ø¨ Ø§Ù„Ø£Ø³Ù†Ø§Ù† Ø¨Ù‡Ø§ Ø£Ù‚Ù„ ØªØºØ·ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹ - ÙØ±ØµØ© Ù„Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©' }
    ];

    // Dummy drivers for admin panel
    const dummyDrivers = [
      { name: 'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', user_type: 'bus-driver', car_model: 'Mercedes Sprinter 2021', car_plate: '1234 MOZ', phone: '07701234567', points: 285, rides: 42, status: 'active' },
      { name: 'Ø³Ø§Ø±Ø© Ø®Ø§Ù„Ø¯', user_type: 'car-driver', car_model: 'Toyota Corolla 2020', car_plate: '5678 NIN', phone: '07702345678', points: 210, rides: 31, status: 'active' },
      { name: 'Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†', user_type: 'bus-driver', car_model: 'Hyundai County 2019', car_plate: '9012 MOZ', phone: '07703456789', points: 175, rides: 28, status: 'active' },
      { name: 'ÙØ§Ø·Ù…Ø© Ø¹Ù…Ø±', user_type: 'car-driver', car_model: 'Kia Cerato 2022', car_plate: '3456 NIN', phone: '07704567890', points: 150, rides: 22, status: 'inactive' },
      { name: 'Ø¹Ù„ÙŠ Ù…Ø­Ù…ÙˆØ¯', user_type: 'bus-driver', car_model: 'Isuzu Journey 2020', car_plate: '7890 MOZ', phone: '07705678901', points: 130, rides: 19, status: 'active' },
      { name: 'Ø²ÙŠÙ†Ø¨ Ø£Ø­Ù…Ø¯', user_type: 'car-driver', car_model: 'Hyundai Elantra 2021', car_plate: '2345 NIN', phone: '07706789012', points: 95, rides: 14, status: 'active' },
      { name: 'Ø­Ø³Ù† Ø¬Ø§Ø³Ù…', user_type: 'car-driver', car_model: 'Toyota Yaris 2019', car_plate: '6789 NIN', phone: '07707890123', points: 60, rides: 9, status: 'inactive' },
      { name: 'Ù…Ø±ÙŠÙ… Ù†Ø§ØµØ±', user_type: 'bus-driver', car_model: 'Mercedes Vito 2022', car_plate: '0123 MOZ', phone: '07708901234', points: 45, rides: 6, status: 'active' }
    ];

    // Peak schedule entries
    let peakScheduleEntries = [
      { day: 'Ø§Ù„Ø£Ø­Ø¯', time: '08:00', endTime: '09:30', note: 'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù… Ø§Ù„ØµØ¨Ø§Ø­ÙŠ' },
      { day: 'Ø§Ù„Ø£Ø­Ø¯', time: '12:30', endTime: '13:30', note: 'Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©' },
      { day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', time: '14:00', endTime: '15:00', note: 'Ø§Ù…ØªØ­Ø§Ù† ÙƒÙ„ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©' }
    ];
    
    // ==================== SDK INITIALIZATION ====================
    
    const dataHandler = {
      onDataChanged(data) {
        allUsers = data;
      }
    };
    
    async function initDataSDK() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }
    }
    
    // ==================== VIEW MANAGEMENT ====================

    function showView(viewName) {
      // Clean up simulations when switching views
      stopAllSimulations();

      document.querySelectorAll('[id$="-view"]').forEach(view => {
        view.classList.add('view-hidden');
      });

      const targetView = document.getElementById(`${viewName}-view`);
      if (targetView) {
        targetView.classList.remove('view-hidden');
      }
    }

    function stopAllSimulations() {
      simulationIntervals.forEach(interval => clearInterval(interval));
      simulationIntervals = [];
    }

    // ==================== SIMULATION UTILITIES ====================

    function getRandomPosition(center, range) {
      return [
        center[0] + (Math.random() - 0.5) * range,
        center[1] + (Math.random() - 0.5) * range
      ];
    }

    function createCustomIcon(type, size) {
      const colors = {
        student: { bg: '#3b82f6', emoji: 'ğŸ‘¤' },
        bus: { bg: '#10b981', emoji: 'ğŸšŒ' },
        car: { bg: '#f59e0b', emoji: 'ğŸš—' },
        you: { bg: '#ef4444', emoji: 'ğŸ“' }
      };
      const c = colors[type] || colors.student;
      return L.divIcon({
        html: '<div style="width:' + size + 'px;height:' + size + 'px;background:' + c.bg + ';border-radius:50%;border:3px solid white;box-shadow:0 4px 15px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;font-size:' + (size * 0.5) + 'px;">' + c.emoji + '</div>',
        className: '',
        iconSize: [size, size],
        iconAnchor: [size / 2, size / 2]
      });
    }

    function populateAIHints(containerId, hints) {
      const container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = '';
      // Show 2-3 random hints
      const shuffled = [...hints].sort(() => Math.random() - 0.5).slice(0, 3);
      shuffled.forEach(hint => {
        const div = document.createElement('div');
        div.className = 'ai-hint rounded-lg p-3';
        div.innerHTML = '<div class="flex items-start gap-2"><span class="text-lg">' + hint.icon + '</span><div><p class="text-purple-300 text-xs font-bold">' + hint.title + '</p><p class="text-slate-300 text-xs mt-1">' + hint.text + '</p></div></div>';
        container.appendChild(div);
      });
    }
    
    function selectUserType(type) {
      document.querySelectorAll('[id^="btn-"][id$="-type"]').forEach(btn => {
        btn.classList.remove('btn-primary', 'btn-secondary', 'btn-amber');
        btn.classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      });
      
      const selectedBtn = document.getElementById(`btn-${type}-type`);
      selectedBtn.classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      selectedBtn.classList.add('btn-primary');
      
      // Show/hide form fields
      document.getElementById('registration-form').classList.remove('view-hidden');
      document.getElementById('student-fields').classList.add('view-hidden');
      document.getElementById('car-driver-fields').classList.add('view-hidden');
      document.getElementById('bus-driver-fields').classList.add('view-hidden');
      
      if (type === 'student') {
        document.getElementById('student-fields').classList.remove('view-hidden');
      } else if (type === 'car-driver') {
        document.getElementById('car-driver-fields').classList.remove('view-hidden');
      } else if (type === 'bus-driver') {
        document.getElementById('bus-driver-fields').classList.remove('view-hidden');
      }
      
      window.selectedUserType = type;
    }
    
    // ==================== AUTHENTICATION ====================

    function selectLoginUserType(type) {
      selectedLoginUserType = type;
      document.getElementById('login-user-type-selection').classList.add('view-hidden');
      document.getElementById('login-form').classList.remove('view-hidden');
    }

    function resetLoginView() {
      selectedLoginUserType = null;
      document.getElementById('login-user-type-selection').classList.remove('view-hidden');
      document.getElementById('login-form').classList.add('view-hidden');
      document.getElementById('login-email').value = '';
    }

    function handleLogin() {
      const email = document.getElementById('login-email').value.trim();

      if (!email) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        return;
      }

      if (!selectedLoginUserType) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        return;
      }

      // Create a dummy user for testing
      currentUser = {
        user_id: Date.now().toString(),
        user_type: selectedLoginUserType,
        name: 'Ù…Ø³ØªØ®Ø¯Ù… ØªØ¬Ø±ÙŠØ¨ÙŠ',
        email: email,
        phone: '07701234567',
        points: Math.floor(Math.random() * 100),
        rides: Math.floor(Math.random() * 20)
      };

      // Add dummy data based on user type
      if (selectedLoginUserType === 'car-driver' || selectedLoginUserType === 'bus-driver') {
        currentUser.car_model = 'Toyota 2020';
        currentUser.car_plate = '1234 ABC';
        currentUser.driver_license = 'DL-' + Date.now();
      }

      // Navigate to appropriate dashboard
      if (selectedLoginUserType === 'student') {
        showView('student-dashboard');
        initStudentDashboard();
      } else if (selectedLoginUserType === 'car-driver' || selectedLoginUserType === 'bus-driver') {
        showView('driver-dashboard');
        initDriverDashboard();
      } else if (selectedLoginUserType === 'admin') {
        showView('admin-dashboard');
        initAdminDashboard();
      }
    }
    
    function handleRegister() {
      const userType = window.selectedUserType;
      if (!userType) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨');
        return;
      }
      
      const name = document.getElementById('reg-name').value.trim();
      const email = document.getElementById('reg-email').value.trim();
      const phone = document.getElementById('reg-phone').value.trim();
      const password = document.getElementById('reg-password').value.trim();
      
      if (!name || !email || !phone || !password) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }
      
      const userData = {
        user_id: Date.now().toString(),
        user_type: userType,
        name,
        email,
        phone,
        points: 0,
        rides: 0
      };
      
      if (userType === 'student') {
        userData.gender = document.getElementById('reg-gender').value;
        userData.age = parseInt(document.getElementById('reg-age').value) || 0;
        userData.disability = document.getElementById('reg-disability').value || 'Ù„Ø§ ØªÙˆØ¬Ø¯';
        userData.notes = document.getElementById('reg-notes').value || '';
      } else if (userType === 'car-driver') {
        userData.car_model = document.getElementById('reg-car-model').value.trim();
        userData.car_plate = document.getElementById('reg-car-plate').value.trim();
        userData.driver_license = document.getElementById('reg-driver-license').value.trim();
      } else if (userType === 'bus-driver') {
        userData.car_model = document.getElementById('reg-bus-model').value.trim();
        userData.car_plate = document.getElementById('reg-bus-plate').value.trim();
        userData.driver_license = document.getElementById('reg-bus-license').value.trim();
      }
      
      // Save to Data SDK
      if (window.dataSdk) {
        window.dataSdk.create(userData).then(result => {
          if (result.isOk) {
            alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            currentUser = userData;
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = password;
            showView('login');
          } else {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + result.error.message);
          }
        });
      }
    }
    
    function handleLogout() {
      currentUser = null;
      selectedZone = null;
      selectedCustomLocation = null;
      selectedLoginUserType = null;
      stopAllSimulations();
      if (customLocationMarker && studentMap) {
        studentMap.removeLayer(customLocationMarker);
        customLocationMarker = null;
      }
      showView('login');
      resetLoginView();
    }
    
    // ==================== STUDENT DASHBOARD ====================
    
    function initStudentDashboard() {
      switchStudentTab('zones');
    }
    
    function switchStudentTab(tab) {
      document.getElementById('student-zones-tab').classList.add('view-hidden');
      document.getElementById('student-request-tab').classList.add('view-hidden');
      document.getElementById('student-history-tab').classList.add('view-hidden');
      
      document.getElementById('student-tab-zones').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('student-tab-request').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('student-tab-history').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      
      document.getElementById('student-tab-zones').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('student-tab-request').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('student-tab-history').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      
      if (tab === 'zones') {
        document.getElementById('student-zones-tab').classList.remove('view-hidden');
        document.getElementById('student-tab-zones').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('student-tab-zones').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      } else if (tab === 'request') {
        document.getElementById('student-request-tab').classList.remove('view-hidden');
        document.getElementById('student-tab-request').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('student-tab-request').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
        setTimeout(() => initStudentMap(), 100);
      } else if (tab === 'history') {
        document.getElementById('student-history-tab').classList.remove('view-hidden');
        document.getElementById('student-tab-history').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('student-tab-history').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      }
    }
    
    function selectZone(zoneName, zoneId) {
      selectedZone = zones.find(z => z.id === zoneId);
      selectedCustomLocation = null;

      document.querySelectorAll('.zone-button').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.zone-button').classList.add('active');

      document.getElementById('selected-zone-info').classList.remove('view-hidden');
      document.getElementById('selected-zone-name').textContent = zoneName;
      document.getElementById('zone-ai-rating').textContent = 'â­ Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© - ØªÙˆÙØ± Ù†Ù‚Ù„ - Ù…Ø³Ø§ÙØ©: ' + Math.floor(Math.random() * 5 + 1) + ' ÙƒÙ…';
      document.getElementById('request-destination').textContent = zoneName;

      // Remove custom marker if exists
      if (customLocationMarker && studentMap) {
        studentMap.removeLayer(customLocationMarker);
        customLocationMarker = null;
      }
    }
    
    function initStudentMap() {
      if (studentMap) {
        studentMap.remove();
        studentMap = null;
      }
      stopAllSimulations();
      simBusMarkers = [];
      simCarMarkers = [];
      busRouteLines = [];

      const mapContainer = document.getElementById('student-map');
      if (!mapContainer) return;

      studentMap = L.map('student-map', {
        zoomControl: false
      }).setView(MOSUL_CENTER, 15);

      // Satellite imagery base layer
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri',
        maxZoom: 19
      }).addTo(studentMap);

      // Roads and labels overlay
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        opacity: 0.6
      }).addTo(studentMap);
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        opacity: 0.8
      }).addTo(studentMap);

      // Add zone markers
      zones.forEach(zone => {
        L.marker(zone.coords, {
          icon: L.divIcon({
            html: '<div style="font-size: 24px;">' + zone.emoji + '</div>',
            className: 'zone-marker',
            iconSize: [40, 40]
          })
        }).addTo(studentMap);
      });

      // Draw bus route lines
      busRoutes.forEach(route => {
        const line = L.polyline(route.points, {
          color: route.color,
          weight: 3,
          opacity: 0.6,
          dashArray: '8, 8'
        }).addTo(studentMap);
        busRouteLines.push(line);
      });

      // Add simulated bus markers (on their routes)
      busRoutes.forEach((route, i) => {
        const startPos = route.points[0];
        const marker = L.marker(startPos, {
          icon: createCustomIcon('bus', 38)
        }).addTo(studentMap);
        marker.bindPopup('<div style="direction:rtl;text-align:right;"><b>ğŸšŒ Ø­Ø§ÙÙ„Ø© ' + (i + 1) + '</b><br><span style="font-size:11px;">' + route.name + '</span></div>');
        simBusMarkers.push({ marker, route: route, routeIndex: 0, direction: 1 });
      });

      // Add simulated car markers
      for (let i = 0; i < 4; i++) {
        const pos = getRandomPosition(MOSUL_CENTER, 0.008);
        const marker = L.marker(pos, {
          icon: createCustomIcon('car', 32)
        }).addTo(studentMap);
        marker.bindPopup('<div style="direction:rtl;text-align:right;"><b>ğŸš— Ø³ÙŠØ§Ø±Ø© ' + (i + 1) + '</b><br><span style="font-size:11px;">Ø³Ø§Ø¦Ù‚ Ù…ØªØ§Ø­</span></div>');
        simCarMarkers.push({ marker, basePos: pos });
      }

      // Add click handler for custom location selection
      studentMap.on('click', function(e) {
        const lat = e.latlng.lat;
        const lng = e.latlng.lng;

        if (customLocationMarker) {
          studentMap.removeLayer(customLocationMarker);
        }

        customLocationMarker = L.marker([lat, lng], {
          icon: L.divIcon({
            html: '<div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 50%; border: 4px solid white; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5); animation: bounce 0.5s;">ğŸ“</div>',
            className: '',
            iconSize: [40, 40]
          })
        }).addTo(studentMap);

        selectedCustomLocation = { lat, lng };
        selectedZone = null;

        document.querySelectorAll('.zone-button').forEach(btn => btn.classList.remove('active'));
        document.getElementById('selected-zone-info').classList.remove('view-hidden');
        document.getElementById('selected-zone-name').textContent = 'Ù…ÙˆÙ‚Ø¹ Ù…Ø®ØµØµ (' + lat.toFixed(4) + ', ' + lng.toFixed(4) + ')';
        document.getElementById('zone-ai-rating').textContent = 'ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©';
        document.getElementById('request-destination').textContent = 'Ù…ÙˆÙ‚Ø¹ Ù…Ø®ØµØµ';
      });

      // Start student map simulation
      startStudentSimulation();

      // Populate AI hints
      populateAIHints('student-ai-hints', aiHintsStudent);
    }

    function startStudentSimulation() {
      // Move buses along their routes
      const busInterval = setInterval(() => {
        simBusMarkers.forEach(bus => {
          bus.routeIndex += bus.direction;
          if (bus.routeIndex >= bus.route.points.length - 1) bus.direction = -1;
          if (bus.routeIndex <= 0) bus.direction = 1;
          const pos = bus.route.points[bus.routeIndex];
          bus.marker.setLatLng(pos);
        });
      }, 3000);
      simulationIntervals.push(busInterval);

      // Move cars randomly
      const carInterval = setInterval(() => {
        simCarMarkers.forEach(car => {
          const newPos = getRandomPosition(car.basePos, 0.002);
          car.marker.setLatLng(newPos);
        });
      }, 4000);
      simulationIntervals.push(carInterval);

      // Update live stats
      const statsInterval = setInterval(() => {
        const busCount = Math.floor(Math.random() * 2) + 2;
        const carCount = Math.floor(Math.random() * 3) + 3;
        const eta = Math.floor(Math.random() * 5) + 2;
        const busEl = document.getElementById('live-bus-count');
        const carEl = document.getElementById('live-car-count');
        const etaEl = document.getElementById('live-eta');
        if (busEl) busEl.textContent = busCount;
        if (carEl) carEl.textContent = carCount;
        if (etaEl) etaEl.textContent = eta + 'Ø¯';
      }, 6000);
      simulationIntervals.push(statsInterval);

      // Rotate AI hints
      const hintInterval = setInterval(() => {
        populateAIHints('student-ai-hints', aiHintsStudent);
      }, 15000);
      simulationIntervals.push(hintInterval);
    }
    
    function requestRide() {
      if (!selectedZone && !selectedCustomLocation) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹ - Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø©');
        return;
      }

      const btn = document.getElementById('request-button');
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
      btn.disabled = true;

      setTimeout(() => {
        btn.textContent = 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ø­Ù„Ø© âœ“';
        btn.classList.add('bg-emerald-600');
      }, 2000);
    }
    
    // ==================== DRIVER DASHBOARD ====================
    
    function initDriverDashboard() {
      document.getElementById('driver-profile-name').textContent = currentUser.name;
      document.getElementById('driver-profile-email').textContent = currentUser.email;
      document.getElementById('driver-profile-phone').textContent = currentUser.phone;
      document.getElementById('driver-profile-points').textContent = currentUser.points || 0;
      document.getElementById('driver-profile-rides').textContent = currentUser.rides || 0;
      document.getElementById('driver-points-badge').textContent = (currentUser.points || 0) + ' Ù†Ù‚Ø·Ø©';
      
      if (currentUser.user_type === 'car-driver') {
        document.getElementById('driver-car-info').innerHTML = `
          <p class="text-slate-400 text-xs">Ø§Ù„Ø³ÙŠØ§Ø±Ø©</p>
          <p class="text-white">${currentUser.car_model} - ${currentUser.car_plate}</p>
        `;
        document.getElementById('driver-title').textContent = 'Ù„ÙˆØ­Ø© Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø³ÙŠØ§Ø±Ø©';
      } else {
        document.getElementById('driver-car-info').innerHTML = `
          <p class="text-slate-400 text-xs">Ø§Ù„Ø­Ø§ÙÙ„Ø©</p>
          <p class="text-white">${currentUser.car_model} - ${currentUser.car_plate}</p>
        `;
        document.getElementById('driver-title').textContent = 'Ù„ÙˆØ­Ø© Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§ÙÙ„Ø©';
      }
      
      switchDriverTab('map');
    }
    
    function switchDriverTab(tab) {
      document.getElementById('driver-map-tab').classList.add('view-hidden');
      document.getElementById('driver-requests-tab').classList.add('view-hidden');
      document.getElementById('driver-profile-tab').classList.add('view-hidden');
      
      document.getElementById('driver-tab-map').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('driver-tab-requests').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('driver-tab-profile').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      
      document.getElementById('driver-tab-map').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('driver-tab-requests').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('driver-tab-profile').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      
      if (tab === 'map') {
        document.getElementById('driver-map-tab').classList.remove('view-hidden');
        document.getElementById('driver-tab-map').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('driver-tab-map').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
        setTimeout(() => initDriverMap(), 100);
      } else if (tab === 'requests') {
        document.getElementById('driver-requests-tab').classList.remove('view-hidden');
        document.getElementById('driver-tab-requests').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('driver-tab-requests').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      } else if (tab === 'profile') {
        document.getElementById('driver-profile-tab').classList.remove('view-hidden');
        document.getElementById('driver-tab-profile').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('driver-tab-profile').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      }
    }
    
    function initDriverMap() {
      if (driverMap) {
        driverMap.remove();
        driverMap = null;
      }
      stopAllSimulations();
      simStudentMarkers = [];

      const mapContainer = document.getElementById('driver-map');
      if (!mapContainer) return;

      driverMap = L.map('driver-map', {
        zoomControl: false
      }).setView(MOSUL_CENTER, 15);

      // Satellite imagery base layer
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles Â© Esri',
        maxZoom: 19
      }).addTo(driverMap);

      // Roads and labels overlay
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        opacity: 0.6
      }).addTo(driverMap);
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        opacity: 0.8
      }).addTo(driverMap);

      // Add zone markers
      zones.forEach(zone => {
        L.marker(zone.coords, {
          icon: L.divIcon({
            html: '<div style="font-size: 20px;">' + zone.emoji + '</div>',
            className: 'zone-marker',
            iconSize: [35, 35]
          })
        }).addTo(driverMap);
      });

      // Add driver's own position marker
      L.marker(MOSUL_CENTER, {
        icon: createCustomIcon(currentUser.user_type === 'bus-driver' ? 'bus' : 'car', 44)
      }).addTo(driverMap);

      // Add "you are here" pulse ring
      L.circle(MOSUL_CENTER, {
        radius: 40,
        color: currentUser.user_type === 'bus-driver' ? '#10b981' : '#f59e0b',
        fillColor: currentUser.user_type === 'bus-driver' ? '#10b981' : '#f59e0b',
        fillOpacity: 0.15,
        weight: 2
      }).addTo(driverMap);

      // Add simulated student markers
      const studentNames = ['Ø£Ø­Ù…Ø¯', 'Ø³Ø§Ø±Ø©', 'Ù…Ø­Ù…Ø¯', 'ÙØ§Ø·Ù…Ø©', 'Ø¹Ù„ÙŠ', 'Ø²ÙŠÙ†Ø¨', 'Ø­Ø³Ù†', 'Ù…Ø±ÙŠÙ…'];
      const numStudents = Math.floor(Math.random() * 4) + 5; // 5-8 students
      for (let i = 0; i < numStudents; i++) {
        const pos = getRandomPosition(MOSUL_CENTER, 0.01);
        const marker = L.marker(pos, {
          icon: createCustomIcon('student', 28)
        }).addTo(driverMap);
        const name = studentNames[i % studentNames.length];
        const nearestZone = zones[Math.floor(Math.random() * zones.length)];
        marker.bindPopup('<div style="direction:rtl;text-align:right;"><b>ğŸ‘¤ ' + name + '</b><br><span style="font-size:11px;">ÙŠØ±ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¥Ù„Ù‰: ' + nearestZone.name + '</span></div>');
        simStudentMarkers.push({ marker, basePos: pos, name: name, destination: nearestZone.name });
      }

      // Start driver simulation
      startDriverSimulation();
    }

    function startDriverSimulation() {
      // Move student markers slightly
      const studentMoveInterval = setInterval(() => {
        simStudentMarkers.forEach(student => {
          const newPos = getRandomPosition(student.basePos, 0.001);
          student.marker.setLatLng(newPos);
        });
      }, 5000);
      simulationIntervals.push(studentMoveInterval);

      // Update driver stats
      const statsInterval = setInterval(() => {
        const nearbyCount = Math.floor(Math.random() * 4) + 4;
        const requestCount = Math.floor(Math.random() * 3) + 2;
        const routes = ['Ø®Ø· 1', 'Ø®Ø· 2', 'Ø®Ø· 3'];
        const el1 = document.getElementById('driver-nearby-students');
        const el2 = document.getElementById('driver-active-requests');
        const el3 = document.getElementById('driver-suggested-route');
        if (el1) el1.textContent = nearbyCount;
        if (el2) el2.textContent = requestCount;
        if (el3) el3.textContent = routes[Math.floor(Math.random() * routes.length)];
      }, 5000);
      simulationIntervals.push(statsInterval);

      // Update driver alert text
      const alertMessages = [
        '~8 Ø·Ù„Ø§Ø¨ Ù…ØªÙˆÙ‚Ø¹ÙŠÙ† ÙÙŠ Ù…Ù†Ø·Ù‚ØªÙƒ Ø®Ù„Ø§Ù„ 10 Ø¯Ù‚Ø§Ø¦Ù‚',
        'Ø§Ø²Ø¯Ø­Ø§Ù… Ù…Ø±ØªÙØ¹ Ø¹Ù†Ø¯ Ø¨Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø§Ø³Ø© - ØªÙˆØ¬Ù‡ Ù„ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©',
        'Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø­Ø§Ø¶Ø±Ø© ÙÙŠ ÙƒÙ„ÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø®Ù„Ø§Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ - ØªÙˆÙ‚Ø¹ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø·Ù„Ø¨',
        '3 Ø·Ù„Ø§Ø¨ ÙŠÙ†ØªØ¸Ø±ÙˆÙ† Ø¹Ù†Ø¯ Ø¨Ø§Ø¨ Ø§Ù„ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø¢Ù†'
      ];
      let alertIndex = 0;
      const alertInterval = setInterval(() => {
        alertIndex = (alertIndex + 1) % alertMessages.length;
        const el = document.getElementById('driver-alert-text');
        if (el) el.textContent = alertMessages[alertIndex];
      }, 8000);
      simulationIntervals.push(alertInterval);

      // Initial stats
      const el1 = document.getElementById('driver-nearby-students');
      const el2 = document.getElementById('driver-active-requests');
      const el3 = document.getElementById('driver-suggested-route');
      if (el1) el1.textContent = simStudentMarkers.length;
      if (el2) el2.textContent = Math.floor(Math.random() * 3) + 2;
      if (el3) el3.textContent = 'Ø®Ø· 1';

      // Populate driver AI hints and requests
      populateAIHints('driver-ai-hints', aiHintsDriver);
      populateDriverRequests();
    }

    function populateDriverRequests() {
      const list = document.getElementById('driver-requests-list');
      if (!list) return;
      list.innerHTML = '';

      const studentNames = ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', 'Ø³Ø§Ø±Ø© Ø¹Ù„ÙŠ', 'Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯', 'ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†', 'Ø¹Ù„ÙŠ Ø¹Ù…Ø±'];
      const numRequests = Math.floor(Math.random() * 3) + 3;

      for (let i = 0; i < numRequests; i++) {
        const name = studentNames[i % studentNames.length];
        const zone = zones[Math.floor(Math.random() * zones.length)];
        const minutes = Math.floor(Math.random() * 10) + 1;
        const card = document.createElement('div');
        card.className = 'gradient-card rounded-lg p-3 border border-slate-700/50';
        card.innerHTML =
          '<div class="flex items-center justify-between mb-2">' +
            '<div><p class="text-white font-bold text-sm">ğŸ‘¤ ' + name + '</p>' +
            '<p class="text-slate-400 text-xs">Ø§Ù„ÙˆØ¬Ù‡Ø©: ' + zone.emoji + ' ' + zone.name + '</p></div>' +
            '<p class="text-slate-500 text-xs">Ù…Ù†Ø° ' + minutes + ' Ø¯</p>' +
          '</div>' +
          '<div class="flex gap-2">' +
            '<button onclick="this.parentElement.parentElement.remove()" class="flex-1 py-2 rounded-lg btn-primary text-white text-xs font-bold">Ù‚Ø¨ÙˆÙ„</button>' +
            '<button onclick="this.parentElement.parentElement.remove()" class="flex-1 py-2 rounded-lg bg-slate-700 text-slate-300 text-xs font-bold">Ø±ÙØ¶</button>' +
          '</div>';
        list.appendChild(card);
      }
    }
    
    // ==================== ADMIN DASHBOARD ====================

    function initAdminDashboard() {
      switchAdminTab('drivers');
      populateAdminDriversList();
    }

    function switchAdminTab(tab) {
      document.getElementById('admin-drivers-tab').classList.add('view-hidden');
      document.getElementById('admin-rewards-tab').classList.add('view-hidden');
      document.getElementById('admin-schedule-tab').classList.add('view-hidden');

      document.getElementById('admin-tab-drivers').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('admin-tab-rewards').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      document.getElementById('admin-tab-schedule').classList.remove('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');

      document.getElementById('admin-tab-drivers').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('admin-tab-rewards').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
      document.getElementById('admin-tab-schedule').classList.add('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');

      if (tab === 'drivers') {
        document.getElementById('admin-drivers-tab').classList.remove('view-hidden');
        document.getElementById('admin-tab-drivers').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('admin-tab-drivers').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
      } else if (tab === 'rewards') {
        document.getElementById('admin-rewards-tab').classList.remove('view-hidden');
        document.getElementById('admin-tab-rewards').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('admin-tab-rewards').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
        populateRewardsList();
      } else if (tab === 'schedule') {
        document.getElementById('admin-schedule-tab').classList.remove('view-hidden');
        document.getElementById('admin-tab-schedule').classList.remove('bg-slate-800/50', 'border-slate-700/50', 'text-slate-400');
        document.getElementById('admin-tab-schedule').classList.add('bg-emerald-500/20', 'border-emerald-500', 'text-emerald-400');
        renderPeakSchedule();
      }
    }

    function populateAdminDriversList() {
      const list = document.getElementById('admin-drivers-list');
      list.innerHTML = '';

      // Update summary stats
      const totalDrivers = dummyDrivers.length;
      const activeDrivers = dummyDrivers.filter(d => d.status === 'active').length;
      const totalRides = dummyDrivers.reduce((sum, d) => sum + d.rides, 0);
      document.getElementById('admin-total-drivers').textContent = totalDrivers;
      document.getElementById('admin-active-drivers').textContent = activeDrivers;
      document.getElementById('admin-total-rides').textContent = totalRides;

      // Sort by points descending
      const sorted = [...dummyDrivers].sort((a, b) => b.points - a.points);

      sorted.forEach((driver, index) => {
        const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : '';
        const statusColor = driver.status === 'active' ? 'text-emerald-400' : 'text-red-400';
        const statusText = driver.status === 'active' ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·';
        const typeIcon = driver.user_type === 'bus-driver' ? 'ğŸšŒ' : 'ğŸš—';

        const card = document.createElement('div');
        card.className = 'gradient-card rounded-lg p-3 border border-slate-700/50';
        card.innerHTML =
          '<div class="flex items-center justify-between mb-2">' +
            '<div class="flex items-center gap-2">' +
              (rankEmoji ? '<span class="text-lg">' + rankEmoji + '</span>' : '') +
              '<div>' +
                '<p class="text-white font-bold text-sm">' + driver.name + '</p>' +
                '<p class="text-slate-500 text-xs">' + typeIcon + ' ' + driver.car_model + '</p>' +
              '</div>' +
            '</div>' +
            '<div class="text-left">' +
              '<p class="text-amber-400 font-bold text-lg">' + driver.points + '</p>' +
              '<p class="text-slate-500 text-xs">Ù†Ù‚Ø·Ø©</p>' +
            '</div>' +
          '</div>' +
          '<div class="flex items-center justify-between">' +
            '<div class="flex items-center gap-3">' +
              '<span class="text-slate-500 text-xs">' + driver.car_plate + '</span>' +
              '<span class="text-slate-500 text-xs">ğŸ“ ' + driver.phone + '</span>' +
            '</div>' +
            '<div class="flex items-center gap-2">' +
              '<span class="text-slate-400 text-xs">' + driver.rides + ' Ø±Ø­Ù„Ø©</span>' +
              '<span class="w-2 h-2 rounded-full ' + (driver.status === 'active' ? 'bg-emerald-400' : 'bg-red-400') + '"></span>' +
              '<span class="' + statusColor + ' text-xs">' + statusText + '</span>' +
            '</div>' +
          '</div>';
        list.appendChild(card);
      });
    }

    function populateRewardsList() {
      const list = document.getElementById('admin-rewards-list');
      list.innerHTML = '';

      const rewards = [
        { name: 'ÙƒØªØ§Ø¨ Ø´ÙƒØ±', icon: 'ğŸ“œ', color: 'emerald' },
        { name: 'Ø´Ù‡Ø§Ø¯Ø© Ø¹Ù…Ù„ ØªØ·ÙˆØ¹ÙŠ', icon: 'ğŸ–ï¸', color: 'blue' },        
      ];

      // Sort by points descending
      const sorted = [...dummyDrivers].sort((a, b) => b.points - a.points);

      sorted.forEach((driver) => {
        const rankLabel = driver.points >= 200 ? 'â­ Ù…ØªÙ…ÙŠØ²' : driver.points >= 100 ? 'âœ… Ø¬ÙŠØ¯' : 'ğŸ“Š Ù…Ø¨ØªØ¯Ø¦';
        const typeIcon = driver.user_type === 'bus-driver' ? 'ğŸšŒ' : 'ğŸš—';
        const card = document.createElement('div');
        card.className = 'gradient-card rounded-lg p-3 border border-slate-700/50';
        card.innerHTML =
          '<div class="flex items-center justify-between mb-3">' +
            '<div>' +
              '<p class="text-white font-bold text-sm">' + typeIcon + ' ' + driver.name + '</p>' +
              '<p class="text-slate-500 text-xs">' + driver.points + ' Ù†Ù‚Ø·Ø© - ' + driver.rides + ' Ø±Ø­Ù„Ø©</p>' +
            '</div>' +
            '<span class="text-xs px-2 py-1 rounded-full bg-slate-800 text-slate-300">' + rankLabel + '</span>' +
          '</div>' +
          '<div class="flex gap-2">' +
            rewards.map(function(reward) {
              return '<button onclick="giveReward(\'' + driver.name + '\', \'' + reward.name + '\')" class="flex-1 py-2 rounded-lg bg-' + reward.color + '-500/20 border border-' + reward.color + '-500/50 text-' + reward.color + '-400 text-xs font-medium hover:bg-' + reward.color + '-500/30">' +
                reward.icon + ' ' + reward.name +
              '</button>';
            }).join('') +
          '</div>';
        list.appendChild(card);
      });
    }

    function giveReward(driverName, reward) {
      alert('ØªÙ… Ù…Ù†Ø­ "' + driverName + '" ' + reward + ' Ø¨Ù†Ø¬Ø§Ø­!');
    }

    function addPeakEntry() {
      const day = document.getElementById('peak-day').value;
      const startTime = document.getElementById('peak-start-time').value;
      const endTime = document.getElementById('peak-end-time').value;
      const note = document.getElementById('peak-note').value.trim();

      if (!startTime || !endTime) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©');
        return;
      }

      if (!note) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ùˆ Ø³Ø¨Ø¨ Ø§Ù„Ø°Ø±ÙˆØ©');
        return;
      }

      peakScheduleEntries.push({ day, time: startTime, endTime, note });

      // Clear form
      document.getElementById('peak-note').value = '';

      renderPeakSchedule();
    }

    function removePeakEntry(index) {
      peakScheduleEntries.splice(index, 1);
      renderPeakSchedule();
    }

    function renderPeakSchedule() {
      const list = document.getElementById('peak-schedule-list');
      if (!list) return;
      list.innerHTML = '';

      if (peakScheduleEntries.length === 0) {
        list.innerHTML = '<p class="text-slate-500 text-sm text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙˆÙ‚Ø§Øª Ø°Ø±ÙˆØ© Ù…Ø³Ø¬Ù„Ø©</p>';
        return;
      }

      // Group entries by day
      const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'];
      const grouped = {};
      peakScheduleEntries.forEach((entry, i) => {
        if (!grouped[entry.day]) grouped[entry.day] = [];
        grouped[entry.day].push({ ...entry, originalIndex: i });
      });

      days.forEach(day => {
        if (!grouped[day]) return;
        const dayEntries = grouped[day];

        const daySection = document.createElement('div');
        daySection.className = 'mb-3';
        daySection.innerHTML = '<p class="text-emerald-400 text-xs font-bold mb-2">ğŸ“… ' + day + '</p>';

        dayEntries.forEach(entry => {
          const entryDiv = document.createElement('div');
          entryDiv.className = 'gradient-card rounded-lg p-3 border border-red-500/30 mb-2 flex items-center justify-between';
          entryDiv.innerHTML =
            '<div class="flex-1">' +
              '<div class="flex items-center gap-2 mb-1">' +
                '<span class="text-red-400 text-xs font-bold">ğŸ”´ ' + entry.time + ' - ' + entry.endTime + '</span>' +
              '</div>' +
              '<p class="text-slate-300 text-xs">' + entry.note + '</p>' +
            '</div>' +
            '<button onclick="removePeakEntry(' + entry.originalIndex + ')" class="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-400 hover:bg-red-500/30">' +
              '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>' +
            '</button>';
          daySection.appendChild(entryDiv);
        });

        list.appendChild(daySection);
      });
    }
    
    // ==================== ELEMENT SDK ====================
    
    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
    }
    
    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }
    
    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['subtitle', config.subtitle || defaultConfig.subtitle]
      ]);
    }
    
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
    
    // Initialize
    initDataSDK();
    showView('login');
  </script>
</body>
</html>
